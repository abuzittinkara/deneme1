!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mediasoupClient=t():e.mediasoupClient=t()}(self,(function(){return(()=>{"use strict";var e={426:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Device=void 0;const n=r(45),i=r(275),o=r(657),s=r(734),a=r(739),c=r(204),d=r(738),p=r(922),u=r(630),l=r(249),h=r(859);let f=class extends n.EnhancedEventEmitter{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){super(),this._loaded=!1,this._closed=!1,this._nativeHandler=null,this._nativeFactory=null,this._handlerName=e||null,this._extendedRtpCapabilities=null,this._recvRtpCapabilities=null,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=null,this._observer=new n.EnhancedEventEmitter,this._handleHandler({handlerName:e,handlerFactory:t,Handler:r})}get observer(){return this._observer}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new o.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new o.InvalidStateError("not loaded");return this._sctpCapabilities}async load({routerRtpCapabilities:e}={}){i.logger.debug("load()");if(this._loaded)throw new o.InvalidStateError("already loaded");if(!e)throw new TypeError("missing routerRtpCapabilities");const t=e;try{a.validateRtpCapabilities(t)}catch(e){throw new TypeError(`invalid routerRtpCapabilities: ${e}`)}const r=this._handler.getNativeRtpCapabilities();i.logger.debug("load() | got native RTP capabilities:%o",r);try{a.validateRtpCapabilities(r)}catch(e){throw new TypeError(`invalid native RTP capabilities: ${e}`)}this._extendedRtpCapabilities=a.getExtendedRtpCapabilities(r,t),this._canProduceByKind.audio=a.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=a.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=a.getRecvRtpCapabilities(this._extendedRtpCapabilities);const n=this._handler.getNativeSctpCapabilities();i.logger.debug("load() | got native SCTP capabilities:%o",n);try{c.validateSctpCapabilities(n)}catch(e){throw new TypeError(`invalid native SCTP capabilities: ${e}`)}this._sctpCapabilities=n,this._loaded=!0,this._observer.safeEmit("load")}canProduce(e){if(!this._loaded)throw new o.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:d={},...p}){i.logger.debug("createSendTransport()");return this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:d,...p})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:d={},...p}){i.logger.debug("createRecvTransport()");return this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:s,additionalSettings:a,proprietaryConstraints:c,appData:d,...p})}close(){if(this._closed=!0,this._handler)try{this._handler.close()}catch(e){}}get _handler(){if(!this._nativeHandler)throw new Error("no native handler");return this._nativeHandler}_handleHandler({handlerName:e,handlerFactory:t,Handler:r}){if(e&&"object"==typeof globalThis.RTCRtpReceiver&&e!==p.detectDevice())i.logger.warn(`requested handler "${e}" is not the one currently selected by auto-detection [${p.detectDevice()}]`);else if(e=p.detectDevice(),!e)throw new Error("device not supported");if(t)this._nativeFactory=t;else if(r)this._nativeHandler=new r;else{switch(e){case"Chrome74":this._nativeFactory=s.Chrome74.createFactory();break;case"Chrome70":this._nativeFactory=s.Chrome70.createFactory();break;case"Chrome67":this._nativeFactory=s.Chrome67.createFactory();break;case"Chrome55":this._nativeFactory=s.Chrome55.createFactory();break;case"Firefox60":this._nativeFactory=s.Firefox60.createFactory();break;case"Safari12":this._nativeFactory=s.Safari12.createFactory();break;case"Safari11":this._nativeFactory=s.Safari11.createFactory();break;case"Edge11":this._nativeFactory=s.Edge11.createFactory();break;case"ReactNative":this._nativeFactory=s.ReactNative.createFactory();break;default:throw new Error(`unknown device "${e}"`)}if(!this._nativeFactory)throw new Error(`unknown device "${e}"`);this._nativeHandler=this._nativeFactory()}this._handlerName=e}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:s,sctpParameters:a,iceServers:c,iceTransportPolicy:p,additionalSettings:f,proprietaryConstraints:_,appData:v,...m}){if(!this._loaded)throw new o.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(n))throw new TypeError("missing iceCandidates");if("object"!=typeof s)throw new TypeError("missing dtlsParameters");if(a&&"object"!=typeof a)throw new TypeError("wrong sctpParameters");if(v&&"object"!=typeof v)throw new TypeError("if given, appData must be an object");try{i.validateId(t)}catch(e){throw new TypeError(`invalid id: ${e}`)}try{d.validateIceParameters(r)}catch(e){throw new TypeError(`invalid iceParameters: ${e}`)}try{u.validateIceCandidates(n)}catch(e){throw new TypeError(`invalid iceCandidates: ${e}`)}try{l.validateDtlsParameters(s)}catch(e){throw new TypeError(`invalid dtlsParameters: ${e}`)}if(a)try{h.validateSctpParameters(a)}catch(e){throw new TypeError(`invalid sctpParameters: ${e}`)}const g=new this._handler.Transport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:s,sctpParameters:a,iceServers:c,iceTransportPolicy:p,additionalSettings:f,proprietaryConstraints:_,appData:v,...m});return"send"===e?new i.Transport({direction:e,id:t,handler:g,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind,maxSctpMessageSize:a?a.maxMessageSize:null,appData:v}):new i.Transport({direction:e,id:t,handler:g,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind,maxSctpMessageSize:a?a.maxMessageSize:null,appData:v})}};
